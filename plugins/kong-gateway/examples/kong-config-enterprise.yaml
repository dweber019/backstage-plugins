_format_version: "3.0"
_transform: true

services:
  - host: simple-service
    name: simple-service
    port: 8080
    protocol: http
    read_timeout: 60000
    retries: 5
    write_timeout: 60000
    tags:
      - tag-selector
    routes:
      - name: simple-route
        paths:
          - /simple
        preserve_host: false
        protocols:
          - http
          - https
        regex_priority: 0
        strip_path: true
        https_redirect_status_code: 426

  - name: plugin-service
    host: plugin-service
    path: /
    port: 80
    protocol: http
    routes:
      - name: plugin-route
        paths:
          - /plugin
        protocols:
          - http
        strip_path: false
    plugins:
      - name: rate-limiting
        config:
          second: 20
          minute: 20
          hour: 20
          policy: local

  - name: upstream-service
    host: upstream-service.upstream
    path: /
    port: 80
    protocol: http
    routes:
      - name: upstream-route
        paths:
          - /upstream
        protocols:
          - http
        strip_path: false

upstreams:
  - algorithm: round-robin
    name: upstream-service.upstream
    targets:
      - target: 10.130.12.43:8080
        weight: 50
      - target: 10.130.12.164:8080
        weight: 50
